@model SecretSanta.Data.Models.Wish

<script type="text/javascript">
    function onSuccess(data) {
        const el = document.querySelector('.close');
        el.click();
    }
</script>

        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">@Model.Title</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="col-lg-6">
                    <div class="qwick-view-content">
                        <div class="form">
                            @using (Ajax.BeginForm("Edit", "WishCard", new AjaxOptions { OnSuccess = "onSuccess" }))
                            {

                                @Html.AntiForgeryToken()
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <label>
                                    Title
                                    @Html.TextBoxFor(model => model.Title, new { @placeholder = "Title", @class = "mt-10" })
                                    @Html.ValidationMessageFor(model => model.Title, "", new { @class = "text-danger" })
                                </label>
                                <label>
                                    Price
                                    @Html.TextBoxFor(model => model.Price, new { @placeholder = "Price", @class = "mt-10" })
                                    @Html.ValidationMessageFor(model => model.Price, "", new { @class = "text-danger" })
                                </label>
                                <label>
                                    Link to shop
                                    @Html.TextBoxFor(model => model.LinkToShop, new { @placeholder = "Link", @class = "mt-10" })
                                    @Html.ValidationMessageFor(model => model.LinkToShop, "", new { @class = "text-danger" })
                                </label>
                                <label>
                                    Description
                                    @Html.TextArea("Description", Model.Description, new { @class = "mt-10" })
                                </label>
                                @Html.HiddenFor(model => model.Id)
                                @Html.HiddenFor(model => model.User)
                                @Html.HiddenFor(model => model.UserId)
                                @Html.HiddenFor(model => model.PathToPicture)
                                <div class="button-box button-position">
                                    <input class="action-plus btn-style cr-btn btn-wish-add confirm-btn" type="submit" value="Save Changes" />
                                </div>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="qwick-view-content">
                        <div class="text-center">
                            <div class="tab-pane active show fade mt-10" id="modal1" role="tabpanel">
                                @if (Model.PathToPicture == null)
                                {
                                    <img class="item-pic" src="@Url.Content($"~/Files/default-gift.jpg")" alt="" width="290" height="368" />
                                }
                                else
                                {
                                    <img class="item-pic" src="@Url.Content($"~/Files/{Model.PathToPicture}")" alt="" width="290" height="368" />
                                }
                            </div>
                            <div class="button-box mt-20">
                                <a class="action-plus btn-style cr-btn btn-wish-add" title="Choose photo" href="#">
                                    <span onclick="document.getElementById('file-input-image').click();">Open...</span>
                                    <input id="file-input-image" type="file" name="avatar" style="display: none;" data-wish="@Model.Id"/>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="lg-col-12 pb-30 ml-30 mr-30">



            </div>
        </div>
@Scripts.Render("~/bundles/bootstrap")
@Scripts.Render("~/bundles/SecretSanta/scripts")
<script>
    const inputFile = document.getElementById('file-input-image');
    const wishId = inputFile.dataset.wish;
    inputFile.addEventListener('change', (event) => {
        var dataFile = new FormData();
        dataFile.append('file', inputFile.files[0]);
        alert(wishId);
        dataFile.append('wishId', wishId);
        fetch("https://localhost:44360/api/ChangeImage", {

            method: 'POST',
            body: dataFile
        })
            .then(res => res.json())
            .then(src => {
                const itemPic = document.querySelector('.item-pic');
                itemPic.src = `/Files/${src}`;
            });

    })
</script>
